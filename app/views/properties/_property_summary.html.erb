<div class="property-summary">
<% cache(p) do -%>
  <%
  link = property_detail_path(p)
  %>
  <p class="property-thumbnail">
<% unless p.image.nil? -%>
    <span><%= link_to(image_tag(property_summary_thumbnail(p), alt: "#{p.name} #{property_type(p)} in #{p.resort}"), link) %></span>
<% end -%>
  </p>
  <div class="property-summary-description">
    <h3>
      <%= link_to p.name, link, title: "Read more about #{p.name}" %>
      <% unless p.hotel? || p.for_sale? %>&middot; <%= t('.sleeps') %> <%= p.sleeping_capacity %><% end %>
      <% if sort_method == 'metres_from_lift ASC' %>&middot; <%= t('.nearest_lift' )%> <%= p.nearest_lift %><% end %>
      &middot;
      <%= p.for_sale? ? t('.sale_price', price: format_currency(p.sale_price, p.currency)) : t('.weekly_price', price: format_currency(p.weekly_rent_price, p.currency)) %>
      &middot;
      <%= property_type(p) %> in <%= p.resort %>
    </h3>
    <p class="strapline">
      <%= p.strapline %>
    </p>

    <div class="actions">
      <% if p.for_sale? %>
      <p class="additional-info">
        Property <%= p.floor_area_metres_2 %> m<sup>2</sup><br>
        Land <%= p.plot_size_metres_2 %> m<sup>2</sup>
      </p>
      <% end %>
  <% if p.has_more_info_button_on_summary? -%>
      <p class="contact_owner btn-property"><%= link_to 'More info', link, title: "More info about #{p.name}" %><i class="icon-caret-right"></i></p>
  <% else -%>
      <p class="contact_owner btn-property"><%= link_to t('enquire'), contact_property_path(p), title: "Enquire about #{p.name}" %><i class="icon-caret-right"></i></p>
  <% end -%>
      <p class="email_a_friend btn-property"><%= link_to t('.email_a_friend'), email_a_friend_property_path(p), rel: 'nofollow', title: "Email a friend about #{p.name}" %><i class="icon-caret-right"></i></p>
    </div>
  </div>
  <%= clear %>
<% end -%>
  <% if fav = favourite_for_property(p) %>
  <%= form_for(fav, method: :delete) do |f| %>
  <p><%= f.submit t('favourites.remove') %></p>
  <% end %>
  <% end %>
</div>
