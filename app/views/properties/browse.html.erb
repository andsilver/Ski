<%= content_for :breadcrumbs_and_heading, breadcrumbs_and_heading(@breadcrumbs, @heading) %>

<h1><%= @heading %></h1>

<% if @resort -%>
<%= content_for :theme, @resort.theme %>

<script>
  $(function() {
    $.cookie('quick_search_resort_id', '<%= @resort.id %>', { path: '/' });
  });
</script>
<% end -%>

<%= content_for :links_and_search do %>
<script>
$(function() {
  $('#search-options input, #search-options select').change(function() {
    $('#search-options form').submit();
  });
});
</script>
<section>
<div id="search-options">
<%= form_tag request.path, method: 'get' do %>
<% if @resort -%>
<input type="hidden" name="resort_id" value="<%= @resort.id %>">
<% end -%>
  <select id="sort_method" name="sort_method" class="form-control">
<% if @for_sale %>
    <option<%= ' selected' if sort_method=='normalised_sale_price DESC' %> value="normalised_sale_price DESC">Price high to low</option>
    <option<%= ' selected' if sort_method=='normalised_sale_price ASC' %> value="normalised_sale_price ASC">Price low to high</option>
<% else %>
    <option<%= ' selected' if sort_method=='normalised_weekly_rent_price DESC' %> value="normalised_weekly_rent_price DESC">Price high to low</option>
    <option<%= ' selected' if sort_method=='normalised_weekly_rent_price ASC' %> value="normalised_weekly_rent_price ASC">Price low to high</option>
<% end %>
<% if @resort.try(:ski?) -%>
    <option<%= ' selected' if sort_method=='metres_from_lift ASC' %> value="metres_from_lift ASC"><%= t('.distance_from_lift') %></option>
<% end -%>
<% if @for_sale %>
    <option<%= ' selected' if sort_method=='number_of_bathrooms ASC' %> value="number_of_bathrooms ASC">Number of bathrooms</option>
<% else %>
    <option<%= ' selected' if sort_method=='sleeping_capacity ASC' %> value="sleeping_capacity ASC"><%= I18n.t('sleeping_capacity') %></option>
<% end %>
    <option<%= ' selected' if sort_method=='number_of_bedrooms ASC' %> value="number_of_bedrooms ASC">Number of bedrooms</option>
<% if params[:action] == 'browse_hotels' %>
    <option<%= ' selected' if sort_method=='star_rating DESC' %> value="star_rating DESC">Star rating</option>
<% end %>
  </select>
<% unless @for_sale -%>
  <%= render 'sleeps_select' %>
  <%= render 'board_basis_select' %>
  <%= render 'home/datepickers' %>
<% end -%>
<p>
  <%= raw property_search_filters @search_filters %>
</p>
<% end %>
</div><!--#search-options-->
</section>
<% end %>






<div id="content-with-side-banners">
<div id="property_summaries">
<% if @properties.empty? %>

<p><%= t('properties.no_matching_properties') %></p>

<% else %>

<% @properties.each do |p| %>
<%= render partial: 'properties/property_summary', locals: {p: p.decorate} %>
<% end %>

<%= will_paginate @properties %>
<% end %>
</div><!--#property_summaries-->
</div>
<%= render partial: 'directory_adverts/banners', object: DirectoryAdvert.small_banners_for(@resort) if @resort %>
