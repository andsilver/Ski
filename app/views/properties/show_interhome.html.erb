<%= content_for :breadcrumbs_and_heading, breadcrumbs_and_heading(@property.breadcrumbs, @heading) %>

<%= content_for :theme, @property.theme %>

<% cache(@accommodation) do %>
<%= render partial: 'google_map',
    locals: { lat: @accommodation.geodata_lat, lng: @accommodation.geodata_lng } %>
<script>
  $(function() {
    $('#property-thumbnails a').fancyZoom({scaleImg: true, closeOnClick: true});

    $('.availability-Q').click(function() {
      var win = window.open('<%= contact_property_path(@property) %>', '_blank');
      win.focus();
    });
  });
</script>
<div id="property" itemscope itemtype="http://schema.org/LodgingBusiness">
<%= render partial: 'user_logo', locals: { property: @property } %>
<div class="thumbnail abta">
  <%= image_tag 'abta.png', alt: 'ABTA Member' %>
  The tour operator<br>
  (Interhome) is an<br>
  ABTA Member<br>
  ABTA No. L7890
</div>
<h1 class="property_name"><span><%= t('property_name') %>:</span> <span itemprop="name"><%= @property.name %></span>
<% unless @property.interhome_accommodation.interhome_place.nil? -%>
  (<%= @property.interhome_accommodation.interhome_place.name %>)
<% end -%>
</h1>
<%= render partial: 'price_and_id', locals: { property: @property } %>

<% if fav = favourite_for_property(@property) %>
<%= form_for(fav, method: :delete) do |f| %>
<p>
  <%= f.submit t('favourites.remove'), class: 'btn btn-large btn-danger' %>
  <%= render 'location_button_and_modal' if @accommodation.geodata_lat.present? %>
</p>
<% end %>
<% else %>
<% @favourite = Favourite.new(property_id: @property.id) %>
<%= form_for @favourite do |f| %>
<%= f.hidden_field :property_id %>
<p>
  <button type="submit" class="btn btn-primary btn-large"><i class='icon-heart icon-white'></i>
  <%= t('favourites.add') %></button>
  <%= render 'location_button_and_modal' if @accommodation.geodata_lat.present? %>
</p>
<% end %>
<% end %>

<%= render partial: 'images', locals: { property: @property } %>

<h2><%= I18n.t('features') %></h2>
<div id="features" class="interhome-features">
  <div class="column">
    <%= I18n.t('bedrooms') %>: <%= @accommodation.bedrooms %>
  </div>
  <div class="column">
    <%= I18n.t('bathrooms') %>: <%= @accommodation.bathrooms %>
  </div>
  <div class="column">
    <%= I18n.t('sleeping_capacity') %>: <%= @accommodation.pax %>
  </div>
  <p class="divider">&nbsp;</p>
<% @accommodation.feature_list.each do |feature| %>
  <div class="column">
    <%= feature_tick(true, t("interhome.features.#{feature}")) %><br>
  </div>
<% end %>
  <%= clear %>
</div>

<h2><%= I18n.t('description') %></h2>
<div itemprop="description">
  <h3>Inside</h3>
  <p>
    <%= @accommodation.inside_description %>
  </p>
  <h3>Outside</h3>
  <p>
    <%= @accommodation.outside_description %>
  </p>
</div>
<% if @accommodation.interhome_vacancy -%>
<script>
$(function() {
  $.ajax({
    url: "<%= interhome_booking_form_property_path(@accommodation.id) %>"
  }).done(function(html) {
    $('#interhome_booking_form').replaceWith(html);
  });
});
</script>
<div id="interhome_booking_form"></div>
<% end -%>

<div class="meta">
  <h2>Additional Information</h2>
  <p>
    <a href="<%= interhome_property_path(@accommodation.permalink) %>" itemprop="url">Permalink</a>
  </p>
  <% if @accommodation.geodata_lat.present? -%>
  <p itemprop="geo" itemscope itemtype="http://schema.org/GeoCoordinates">
    Latitude: <%= @accommodation.geodata_lat %><br>
    Longitude: <%= @accommodation.geodata_lng %>
    <meta itemprop="latitude" content="<%= @accommodation.geodata_lat %>">
    <meta itemprop="longitude" content="<%= @accommodation.geodata_lng %>">
  </p>
  <% end -%>
</div>
<%= clear %>

</div><!--#property-->
<% end %>
<%= render partial: 'directory_adverts/banners', object: DirectoryAdvert.small_banners_for(@property.resort) %>
